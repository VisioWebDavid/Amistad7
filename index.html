<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia AMISTAD</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

body {
  font-family: 'Inter', sans-serif;
  background: #0f111a;
  color: #e0e6f0;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  width: 95%;
  max-width: 1100px;
}

.box {
  background: #1a1f2b;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.box:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 40px rgba(0,0,0,0.8);
}

h1, h2 {
  text-align: center;
  font-weight: 700;
  color: #60a5fa;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 14px;
}

th, td {
  border: 1px solid #2a2f42;
  padding: 12px;
  text-align: center;
}

th {
  background: #0e1420;
  color: #60a5fa;
  text-transform: uppercase;
}

tr:nth-child(even) {
  background: #171b2b;
}

tr:nth-child(odd) {
  background: #1f2538;
}

tr.me {
  background: #0d9488 !important;
  font-weight: 600;
}

input, select, textarea {
  padding: 7px;
  border-radius: 8px;
  border: none;
  width: 100%;
  box-sizing: border-box;
  background: #262d44;
  color: #e0e6f0;
}

input:focus, select:focus, textarea:focus {
  outline: 2px solid #60a5fa;
}

input.horas {
  width: 60px;
  text-align: center;
}

textarea.obs {
  width: 100%;
  height: 50px;
  resize: none;
}

button {
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 700;
  margin: 5px;
  transition: background 0.3s ease, transform 0.2s ease;
}

button:hover {
  transform: translateY(-2px);
}

.save {
  background: linear-gradient(90deg,#3b82f6,#60a5fa);
  color: #fff;
}

.trash {
  background: linear-gradient(90deg,#ef4444,#f87171);
  color: #fff;
}

.hidden {
  display: none;
}

.login-box {
  max-width: 380px;
  margin: auto;
  text-align: center;
  padding: 25px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.6);
  border-radius: 16px;
  background: #1a1f2b;
}

.login-box input {
  width: 90%;
  margin: 10px 0;
  font-size: 14px;
  padding: 10px;
  background: #262d44;
  color: #e0e6f0;
}

.login-box input::placeholder {
  color: #94a3b8;
}

.login-box button {
  width: 92%;
  font-size: 15px;
}

#claveBox {
  margin-top: 10px;
}

small.note {
  display: block;
  text-align: center;
  color: #94a3b8;
  margin-top: 8px;
  font-size: 12px;
}
</style>

</head>
<body>
<div class="container">

  <!-- LOGIN -->
  <div class="box login-box" id="loginBox">
    <h1>üîë Iniciar Sesi√≥n</h1>
    <input type="text" id="nombreInput" placeholder="Tu nombre (Ej: Eleazar Anguiz)" oninput="verClave()">
    <div id="claveBox" class="hidden">
      <input type="password" id="claveInput" placeholder="Clave de jefe">
    </div>
    <br>
    <button class="save" onclick="login()">Entrar</button>
    <small class="note">Escribe tu nombre exactamente como aparece en la lista (sin tildes ni signos).</small>
  </div>

  <!-- MAIN -->
  <div class="box hidden" id="mainBox">
    <h2 id="tituloInforme"></h2>
    <p style="text-align:center;">Conectado como: <b id="userName"></b></p>
    <table>
      <thead>
        <tr>
          <th>Participantes</th>
          <th>P</th>
          <th>C.B.</th>
          <th>Inform√≥</th>
          <th>Horas</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody id="tablaBody"></tbody>
    </table>
    <div style="text-align:center; margin-top:15px;">
      <button class="save" onclick="guardar()">üíæ Guardar</button>
      <button class="trash" onclick="borrar()">üóëÔ∏è Borrar</button>
    </div>
    <p style="text-align:center; font-size:12px; color:#94a3b8;">Solo puedes editar tu fila ‚ú® (el jefe puede editar todas).</p>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBvhhWhOIdVJ8-dz8PwiQVgNarBuKWMewo",
  authDomain: "informe-ce682.firebaseapp.com",
  databaseURL: "https://informe-ce682-default-rtdb.firebaseio.com",
  projectId: "informe-ce682",
  storageBucket: "informe-ce682.firebasestorage.app",
  messagingSenderId: "329337906154",
  appId: "1:329337906154:web:09b736ce1be3b018854893",
  measurementId: "G-Z2LH0JRJMH"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<script>
const participantes = [
  "Amador Miguel",
  "Eleazar Anguiz",
  "Barrera Bartolome",
  "Garcia Saul",
  "Garcia Allison",
  "Garcia Britney",
  "Garcia David",
  "Hernandez Liliana",
  "Iribe Sergio",
  "Leon Oriandi",
  "Olguin Griselda",
  "Quintero Laura",
  "Silvas Alexia",
  "Silvas Danya"
];

let usuario = "";
let esJefe = false;

document.addEventListener('DOMContentLoaded', () => {
  const now = new Date();
  const mesNombre = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][now.getMonth()];
  document.getElementById("tituloInforme").textContent = `Informe ‚Äî ${mesNombre} ‚Äî Grupo 6`;
});

function verClave(){
  const nombre = document.getElementById("nombreInput").value.trim();
  document.getElementById("claveBox").classList.toggle("hidden", nombre.toLowerCase() !== "eleazar anguiz");
}

function login(){
  const nombreInput = document.getElementById("nombreInput").value.trim();
  if(!nombreInput){
    alert("Escribe tu nombre");
    return;
  }

  const nombreNorm = nombreInput.replace(/\s+/g,' ').trim();
  const encontrado = participantes.find(p => p.toLowerCase() === nombreNorm.toLowerCase());
  if(!encontrado){
    alert("Nombre no encontrado. Escribe exactamente como en la lista (sin tildes ni signos).");
    return;
  }

  if(encontrado.toLowerCase() === "eleazar anguiz"){
    const clave = document.getElementById("claveInput").value.trim();
    if(clave !== "ELE12345"){
      alert("Clave incorrecta");
      return;
    }
    esJefe = true;
  }

  usuario = encontrado;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("mainBox").classList.remove("hidden");
  document.getElementById("userName").textContent = usuario;
  renderTabla();
}

function renderTabla(){
  const body = document.getElementById("tablaBody");
  body.innerHTML = "";

  database.ref('asistencia/grupo6').once('value').then(snapshot => {
    const allData = snapshot.val() || {};

    participantes.forEach(nombre => {
      const tr = document.createElement("tr");
      if(nombre === usuario && !esJefe) tr.classList.add("me");

      const saved = allData[nombre] || {};

      tr.innerHTML = `
        <td style="text-align:left; padding-left:12px;">${nombre}</td>
        <td><input type="checkbox" ${saved.p ? "checked" : ""} ${!esJefe && nombre!==usuario ? "disabled" : ""}></td>
        <td>
          <select ${!esJefe && nombre!==usuario ? "disabled" : ""}>
            <option value="">-</option>
            <option value="1" ${saved.cb==="1"?"selected":""}>1</option>
            <option value="2" ${saved.cb==="2"?"selected":""}>2</option>
            <option value="3" ${saved.cb==="3"?"selected":""}>3</option>
            <option value="4" ${saved.cb==="4"?"selected":""}>4</option>
            <option value="5" ${saved.cb==="5"?"selected":""}>5</option>
          </select>
        </td>
        <td>
          <select ${!esJefe && nombre!==usuario ? "disabled" : ""}>
            <option value="">-</option>
            <option value="Precursor Auxiliar" ${saved.info==="Precursor Auxiliar"?"selected":""}>Precursor Auxiliar</option>
            <option value="Precursor Regular" ${saved.info==="Precursor Regular"?"selected":""}>Precursor Regular</option>
          </select>
        </td>
        <td><input type="text" class="horas" value="${saved.horas||""}" ${!esJefe && nombre!==usuario ? "disabled" : ""}></td>
        <td><textarea class="obs" ${!esJefe && nombre!==usuario ? "disabled" : ""}>${saved.obs||""}</textarea></td>
      `;

      body.appendChild(tr);
    });
  }).catch(err=>{
    console.error("Error leyendo Firebase:", err);
    alert("No se pudo leer los datos de Firebase. Revisa la consola.");
  });
}

function guardar(){
  const rows = document.querySelectorAll("#tablaBody tr");
  const updates = {};
  rows.forEach(tr=>{
    const nombre = tr.cells[0].textContent.trim();
    if(esJefe || nombre===usuario){
      const data = {
        p: tr.cells[1].querySelector("input").checked,
        cb: tr.cells[2].querySelector("select").value,
        info: tr.cells[3].querySelector("select").value,
        horas: tr.cells[4].querySelector("input").value,
        obs: tr.cells[5].querySelector("textarea").value,
        updatedAt: Date.now()
      };
      updates[`asistencia/grupo6/${nombre}`] = data;
    }
  });

  database.ref().update(updates).then(()=>{
    alert("‚úÖ Datos guardados");
  }).catch(err=>{
    console.error("Error guardando en Firebase:", err);
    alert("Error al guardar. Revisa la consola.");
  });
}

function borrar(){
  if(!confirm("¬øSeguro que quieres borrar tus datos?")) return;

  if(esJefe){
    if(!confirm("Eres jefe: esto borrar√° TODOS los registros del grupo. ¬øContinuar?")) return;
    database.ref('asistencia/grupo6').remove().then(()=>{ renderTabla(); alert("‚úÖ Todos los datos borrados"); }).catch(err=>{ console.error(err); alert("Error al borrar"); });
    return;
  }

  const path = `asistencia/grupo6/${usuario}`;
  database.ref(path).remove().then(()=>{ renderTabla(); alert("‚úÖ Tus datos fueron borrados"); }).catch(err=>{ console.error(err); alert("Error al borrar tus datos"); });
}
</script>
</body>
</html>





