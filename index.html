<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia AMISTAD</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#1e293b; color:#f1f5f9; margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container {width:95%; max-width:1100px;}
.box {background:#1e293b; padding:25px; border-radius:16px; box-shadow:0 8px 25px rgba(0,0,0,0.6);}
h1,h2{text-align:center;}
table {width:100%; border-collapse:collapse; margin-top:15px; font-size:14px;}
th, td {border:1px solid #334155; padding:10px; text-align:center;}
th {background:#0f172a;}
tr:nth-child(even){background:#1e293b;}
tr:nth-child(odd){background:#243046;}
tr.me{background:#0d9488 !important;}
input, select, textarea {padding:6px; border-radius:6px; border:none; width:100%; box-sizing:border-box;}
input.horas { width: 60px; text-align:center; } /* horas m√°s chico */
textarea.obs { width:100%; height:50px; resize:none; }
button {padding:10px 18px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; margin:5px;}
.save {background: linear-gradient(90deg,#3b82f6,#60a5fa); color:#fff;}
.trash {background: linear-gradient(90deg,#ef4444,#f87171); color:#fff;}
.hidden{display:none;}
.login-box {max-width:380px; margin:auto; text-align:center; padding:20px; box-shadow:0 6px 20px rgba(0,0,0,0.5); border-radius:12px;}
.login-box input {width:90%; margin:10px 0; font-size:14px; padding:8px;}
.login-box button {width:92%; font-size:15px;}
#claveBox {margin-top:8px;}
</style>
</head>
<body>
<div class="container">

  <!-- LOGIN -->
  <div class="box login-box" id="loginBox">
    <h1>üîë Iniciar Sesi√≥n</h1>
    <input type="text" id="nombreInput" placeholder="Tu nombre" oninput="verClave()">
    <div id="claveBox" class="hidden">
      <input type="password" id="claveInput" placeholder="Clave de jefe">
    </div>
    <br>
    <button class="save" onclick="login()">Entrar</button>
  </div>

  <!-- MAIN -->
  <div class="box hidden" id="mainBox">
    <h2 id="tituloInforme"></h2>
    <p style="text-align:center;">Conectado como: <b id="userName"></b></p>
    <table>
      <thead>
        <tr>
          <th>Participantes</th>
          <th>P</th>
          <th>C.B.</th>
          <th>Inform√≥</th>
          <th>Horas</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody id="tablaBody"></tbody>
    </table>
    <div style="text-align:center; margin-top:15px;">
      <button class="save" onclick="guardar()">üíæ Guardar</button>
      <button class="trash" onclick="borrar()">üóëÔ∏è Borrar</button>
    </div>
    <p style="text-align:center; font-size:12px; color:#94a3b8;">Solo puedes editar tu fila ‚ú® (el jefe puede editar todas).</p>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBvhhWhOIdVJ8-dz8PwiQVgNarBuKWMewo",
  authDomain: "informe-ce682.firebaseapp.com",
  databaseURL: "https://informe-ce682-default-rtdb.firebaseio.com",
  projectId: "informe-ce682",
  storageBucket: "informe-ce682.firebasestorage.app",
  messagingSenderId: "329337906154",
  appId: "1:329337906154:web:09b736ce1be3b018854893",
  measurementId: "G-Z2LH0JRJMH"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<script>
const participantes = [
  "Acosta Castulo",
  "Borquez Veronica",
  "Diaz Julia",
  "Gamez Briss",
  "Melendez Anabelia",
  "Perez Fernando",
  "Ramirez Ana",
  "Rios Fermina",
  "Salas Ailin",
  "Salas Alexander",
  "Salas Iker",
  "Salas David",
  "Zamora Jorge",
  "Zamora Atziry"
];

let usuario = "";
let esJefe = false;
const now = new Date();
const mesNombre = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][now.getMonth()];
document.getElementById("tituloInforme").textContent = `Informe ‚Äî ${mesNombre} ‚Äî Grupo 7`;

function verClave(){
  const nombre = document.getElementById("nombreInput").value.trim();
  document.getElementById("claveBox").classList.toggle("hidden", nombre !== "Salas Alexander");
}

function login(){
  const nombre = document.getElementById("nombreInput").value.trim();
  if(!participantes.includes(nombre)){ 
    alert("Nombre no encontrado"); 
    return; 
  }
  if(nombre === "Salas Alexander"){
    const clave = document.getElementById("claveInput").value.trim();
    if(clave !== "DAVID1910"){ alert("Clave incorrecta"); return; }
    esJefe = true;
  }
  usuario = nombre;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("mainBox").classList.remove("hidden");
  document.getElementById("userName").textContent = usuario;
  renderTabla();
}

function renderTabla(){
  const body = document.getElementById("tablaBody");
  body.innerHTML = "";

  database.ref('asistencia').once('value').then(snapshot => {
    const allData = snapshot.val() || {};

    participantes.forEach(nombre => {
      const tr = document.createElement("tr");
      if(nombre === usuario && !esJefe) tr.classList.add("me");

      const saved = allData[nombre] || {};

      tr.innerHTML = `
        <td>${nombre}</td>
        <td><input type="checkbox" ${saved.p ? "checked" : ""} ${!esJefe && nombre!==usuario ? "disabled" : ""}></td>
        <td>
          <select ${!esJefe && nombre!==usuario ? "disabled" : ""}>
            <option value="">-</option>
            <option value="1" ${saved.cb==="1"?"selected":""}>1</option>
            <option value="2" ${saved.cb==="2"?"selected":""}>2</option>
            <option value="3" ${saved.cb==="3"?"selected":""}>3</option>
            <option value="4" ${saved.cb==="4"?"selected":""}>4</option>
            <option value="5" ${saved.cb==="5"?"selected":""}>5</option>
          </select>
        </td>
        <td>
          <select ${!esJefe && nombre!==usuario ? "disabled" : ""}>
            <option value="">-</option>
            <option value="Precursor Auxiliar" ${saved.info==="Precursor Auxiliar"?"selected":""}>Precursor Auxiliar</option>
            <option value="Precursor Regular" ${saved.info==="Precursor Regular"?"selected":""}>Precursor Regular</option>
          </select>
        </td>
        <td><input type="text" class="horas" value="${saved.horas||""}" ${!esJefe && nombre!==usuario ? "disabled" : ""}></td>
        <td><textarea class="obs" ${!esJefe && nombre!==usuario ? "disabled" : ""}>${saved.obs||""}</textarea></td>
      `;

      body.appendChild(tr);
    });
  });
}

function guardar(){
  const rows = document.querySelectorAll("#tablaBody tr");
  rows.forEach(tr=>{
    const nombre = tr.cells[0].textContent;
    if(esJefe || nombre===usuario){
      const data = {
        p: tr.cells[1].querySelector("input").checked,
        cb: tr.cells[2].querySelector("select").value,
        info: tr.cells[3].querySelector("select").value,
        horas: tr.cells[4].querySelector("input").value,
        obs: tr.cells[5].querySelector("textarea").value
      };
      database.ref(`asistencia/${nombre}`).set(data);
    }
  });
  alert("‚úÖ Datos guardados");
}

function borrar(){
  if(confirm("¬øSeguro que quieres borrar tus datos?")){
    const rows = document.querySelectorAll("#tablaBody tr");
    rows.forEach(tr=>{
      const nombre = tr.cells[0].textContent;
      if(esJefe || nombre===usuario){
        database.ref(`asistencia/${nombre}`).remove();
      }
    });
    renderTabla();
  }
}
</script>
</body>
</html>






